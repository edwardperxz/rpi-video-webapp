<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Reproductor de videos - Demo</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- Validación de registro removida para testing -->
  <header class="site-header">
    <div class="inner">
      <h1>Reproductor de videos</h1>
      <nav style="margin-top:0.5rem">
        <a href="account.html" style="color:rgba(255,255,255,0.95);text-decoration:underline;margin-right:1rem;">Mi cuenta</a>
        <a href="register.html" style="color:rgba(255,255,255,0.95);text-decoration:underline;">Registrarse / Iniciar</a>
      </nav>
    </div>
  </header>

    <main class="container">
    <section class="grid" aria-label="Listado de videos" id="videos-grid">
      <!-- Videos will be loaded dynamically here -->
    </section>
  </main>

  <script>
    async function loadVideos() {
      try {
        const response = await fetch('/api/videos');
        if (!response.ok) {
          throw new Error('Failed to fetch videos');
        }
        const videos = await response.json();
        const grid = document.getElementById('videos-grid');

        if (videos.length === 0) {
          grid.innerHTML = '<p style="grid-column: 1 / -1; text-align: center; color: var(--text-muted);">No hay videos disponibles</p>';
          return;
        }
        grid.innerHTML = videos.map(video => {
          const encodedPath = encodeURIComponent(video.path);
          const encodedTitle = encodeURIComponent(video.title);
          const watchUrl = `watch.html?video=${encodedPath}&title=${encodedTitle}`;
          return `
            <article class="video-card">
              <a class="thumb" href="${watchUrl}" aria-label="Ver ${video.title}">
                <video preload="metadata" playsinline>
                  <source src="${video.path}" type="video/mp4">
                </video>
              </a>
              <div class="meta">
                <h3><a href="${watchUrl}">${video.title}</a></h3>
              </div>
            </article>
          `;
        }).join('');
        
        // Set up thumbnail display for all video elements
        const videoElements = grid.querySelectorAll('video');
        videoElements.forEach(video => {
          video.pause();
          
          const showThumbnail = () => {
            video.currentTime = 0;
          };
          
          video.addEventListener('loadedmetadata', showThumbnail);
          
          video.addEventListener('seeked', () => {
            video.pause();
          });
          
          if (video.readyState >= 1) {
            showThumbnail();
          }
        });
      } catch (error) {
        console.error('Error loading videos:', error);
        const grid = document.getElementById('videos-grid');
        grid.innerHTML = '<p style="grid-column: 1 / -1; text-align: center; color: var(--error, #ff4444);">Error al cargar los videos</p>';
      }
    }
    // Load videos when page loads
    document.addEventListener('DOMContentLoaded', loadVideos);
  </script>

  <footer class="site-footer">
    <div class="footer-inner">
      <p class="made-by">Desarrollado por <strong>Los Cheveronazos</strong> · Redes Computacionales · Universidad Tecnológica de Panamá</p>
    </div>
  </footer>
</body>
</html>
